#! /bin/sh 

EXEC=org.globus.cog.abstraction.examples.taskgraph.HierarchicalDAGVisualizer
OPTIONS=

CYGWIN=
CPDELIM=":"

if echo `uname` | grep -i "cygwin"; then
    CYGWIN="yes"
    CPDELIM=";"
fi

fixCommandLine() {

    COMMANDLINE=

    while [ "X$1" !=  "X" ] ; do
        COMMANDLINE="${COMMANDLINE} '$1'"
        shift
    done

    echo $COMMANDLINE
}

updateOptions() {
 
    if [ "X$1" != "X" ] ; then
	OPTIONS="$OPTIONS -D$2=$1"
    fi

}

####### MAIN BODY ##########

if [ ! -d "$COG_INSTALL_PATH" ] ; then
    COG_INSTALL_PATH=`dirname $0`"/../.."
    if [ ! -f "$COG_INSTALL_PATH/lib/cog-abstraction-examples-2.1.jar" ] && [ ! -f "$COG_INSTALL_PATH/lib/cog.jar" ] ; then
		MY_PATH=`which $0`
		COG_INSTALL_PATH=`dirname $MY_PATH`"/../.."
		if [ ! -f "$COG_INSTALL_PATH/lib/cog-abstraction-examples-2.1.jar" ] && [ ! -f "$COG_INSTALL_PATH/lib/cog.jar" ] ; then
	    	echo "Error: COG_INSTALL_PATH is not set, and all attempts at guessing it failed"
	    	exit
		fi
    fi
fi

OPTIONS="$OPTIONS -Djava.endorsed.dirs=$COG_INSTALL_PATH/lib/endorsed"

LOCALCLASSPATH=$CLASSPATH$CPDELIM$COG_INSTALL_PATH/etc
for JAR in $COG_INSTALL_PATH/lib/*.jar; do
	LOCALCLASSPATH="$LOCALCLASSPATH$CPDELIM$JAR"
done

CMDLINE=`fixCommandLine "$@"`

### SETUP OTHER ENV VARIABLES ####

USERID=`id | awk '{printf("%s\n", substr($1, 5, index($1, "(")-5 ) ) }'`

updateOptions "$USERID" "UID"
updateOptions "$GLOBUS_INSTALL_PATH" "GLOBUS_INSTALL_PATH"
updateOptions "$GLOBUS_DEPLOY_PATH" "GLOBUS_DEPLOY_PATH"
updateOptions "$GLOBUS_TCP_PORT_RANGE" "GLOBUS_TCP_PORT_RANGE"
updateOptions "$COG_INSTALL_PATH" "COG_INSTALL_PATH"


### EXECUTE ############
if test -n "$CYGWIN"; then
    set CLASSPATHSAVE=$CLASSPATH
    export CLASSPATH="$LOCALCLASSPATH"
    eval java ${OPTIONS} ${COG_OPTS} ${EXEC} ${CMDLINE}
    export CLASSPATH=$CLASSPATHSAVE
else
    eval java ${OPTIONS} ${COG_OPTS} -classpath ${LOCALCLASSPATH} ${EXEC} ${CMDLINE}
fi
return_code=$?

exit $return_code


